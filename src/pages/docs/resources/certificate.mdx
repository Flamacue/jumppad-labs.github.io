import MetaProperties from "./shared/meta.mdx"

# Certificate

<Intro>
The Certificate resource is split into two sub resources `certificate_ca` that 
allows you to create x509 Root Certificates and the associated Private Key. 

`certificate_leaf` that allows the creation of self-signed x509 Leaf Certificates 
and associated Private Keys.
</Intro>

# Root Certificates `certificate_ca`

<Intro>
The following parameters are available for creating certificate_ca resources, 
when a new resource is created Shipyard will create the certificate and associated 
private key and write them to the output folder. Certificates do not perisist 
the lifecycle of a blueprint, when a blueprint is destroyed the created certs
and keys are removed from the output folder.

Root Certificates have a pre-set Common Name corresponding to the name of the resource
</Intro>

## Properties

<Properties>
  <Property name="output" type="string" required="true" value=""> 
    Output folder to write the certifcate and private key to.
  </Property>

  <Property name="key" type="#file" value="" readonly> 
    Details related to the private key generated by the `certificate_ca` resource.
  </Property>
  
  <Property name="certificate" type="#file" value="" readonly> 
    Details related the certificate generated by the `certificate_ca` resource.
  </Property>
</Properties>

<MetaProperties/>

# Leaf Certificates `certificate_ca`

<Intro>
The following parameters are available for creating certificate_leaf resources, 
when a new resource is created Shipyard will create the certificate and associated 
private key and write them to the output folder. Certificates do not perisist the 
lifecycle of a blueprint, when a blueprint is destroyed the created certs and 
keys are removed from the output folder.

To create a leaf certificate jumppad needs a valid CA certificate and private
key, these can be generated using the certificate_ca resource or can be an 
existing x509 certificate and associated RSA private key.

Leaf Certificates have a pre-set Common Name corresponding to the name of the resource
</Intro>

## Properties

<Properties>
  <Property name="output" type="string" required="true" value=""> 
    Output folder to write the certifcate and private key to.
  </Property>
  
  <Property name="ca_key" type="string" required="true" value="">
    Path to the key used to generate the certificate authority  
  </Property>
  
  <Property name="ca_cert" type="string" required="true" value="">
    Path to the root certificate
  </Property>
  
  <Property name="ip_addresses" type="[]string" required="false" value="">
    List of IP addresses to add to the certiicate

    ```hcl
      ip_addresses = ["127.0.0.1"]
    ```
  </Property>
  
  <Property name="dns_names" type="[]string" required="false" value="">
    List of DNS names to add to the certiicate

    ```hcl
      dns_names = [
        "localhost",
        "server.${variable.cd_consul_dc}.consul",
        "1.consul.server.container.shipyard.run",
        "2.consul.server.container.shipyard.run",
        "3.consul.server.container.shipyard.run"
      ]
    ```
  </Property>

  <Property name="key" type="#file" value="" readonly> 
    Details related to the private key generated by the `certificate_ca` resource.
  </Property>
  
  <Property name="certificate" type="#file" value="" readonly> 
    Details related to the certificate generated by the `certificate_ca` resource.
  </Property>
</Properties>

## File

<Properties>
  <Property name="output" type="string" required="true" value=""> 
    Output folder to write the certifcate and private key to.
  </Property>
</Properties>

<MetaProperties/>

## Examples

```hcl
resource "certificate_ca" "cd_consul_ca" {
  output = data("certs")
}

resource "certificate_leaf" "cd_consul_server" {
  ca_key = resource.certificate_ca.cd_consul_ca.key_path
  ca_cert = resource.certificate_ca.cd_consul_ca.cert_path

  ip_addresses = ["127.0.0.1"]

  dns_names = [
    "localhost",
    "server.${var.cd_consul_dc}.consul",
    "1.consul.server.container.shipyard.run",
    "2.consul.server.container.shipyard.run",
    "3.consul.server.container.shipyard.run"
  ]

  output = data("certs")
}
```